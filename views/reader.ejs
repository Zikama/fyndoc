<div class="Rectangle-1">
    <% include ./header/index%>

        <div class="art_board">

            <div class="left_aside">
                <div class="uls">
                    <!-- Dashboard -->
                    <button class="art-dop_down io_aro  lis hidden" hidden id="dashboard">Dashboard</button>
                    <!-- Sale Tab container  -->
                    <ul class="art-dop_col ul hidden " id="pa-dashboard">
                        <li class="li"><a href="#sign_in">Sign in</a></li>
                        <li class="li"><a href="#sign_up">Create an account</a></li>
                    </ul>
                    <!-- PSDOC Tab -->
                    <button class="art-dop_down io_aro  lis " id="proposal_doc"> Proposal document </button>
                    <!-- PSDOC Tab container  -->
                    <ul class="art-dop_col ul " id="pa-proposal_doc">
                        <li class="li" id="download_proposal"><a href="#downloading">Download</a></li>
                        <li class="li" id="preview_proposal"><a href="#proposal_id">#<%=typeof data !=='undefined'?data.ref:'7566545'%></a></li>
                    </ul>
                </div>
            </div>

            <div class="posts_con" id="viewport" <% if(status==='signed' ){%> style="min-height:auto"
                <%}%>>
                    <div class="post" <% if(status==='signed' ){%> style="margin:23% auto"
                        <%}%>>
                            <div class="p_body">
                                <% if( typeof proposal_data !== 'undefined'){%>
                                    <div class="pull allow_download">
                                        <div class="p_body_content" id="read_tempo_proposal">
                                        </div>
                                    </div>
                                    <%}%>
                                        <% if(status==='signed'){%>
                                            <div class="pull <%= status === 'signed' ? 'allow_download':''%>">
                                                <%}%>
                                                    <div class="p_body_content" id="read_tempo">
                                                    </div>
                                                    <% if(status==='signed' ){%>
                                            </div>
                                            <%}%>

                                                <div class="p_body_content_wrapper <%= status === 'not-signed' ? 'hidden':''%>" <%=status==='not-signed' ? 'hidden': ''%>>
                                                    <span class="split checkboxes disabled" style="background-color: #a2d7c7;">
                                                <input type="checkbox" role="checkbox" id="signed" name="signed" value="download" checked disabled>
                                                <label for="signed" style="cursor: none">successfully signed</label>
                                            </span>
                                                    <span class="submin">
                                            <p class="terminal">
                                                You've successfully signed this contract.
                                                <br> You can now download the pdf version of the contract down.
                                            </p>
                                            </span>

                                                    <span class="split checkboxes">
                                <input type="checkbox" role="checkbox" id="_download" name="download" value="download" >
                                <label for="_download">Download PDF</label>
                            </span>

                                                    <span class="split checkboxes">
                                <input type="checkbox" role="checkbox" id="_preview" name="_preview" value="preview">
                                <label for="_preview">Preview</label>
                            </span>
                                                    <span class="submin">
                                <p class="terminal"><b>Note: </b>This page we'll be available to you for 30 days from date of signed.</p>
                            </span>
                                                </div>
                            </div>
                    </div>
                    <%if (status ==='not-signed'){%>
                        <div class="post ">
                            <div class="p_body">
                                <div class="p_body_content">
                                    <div class="p_body_content_wrapper">
                                        <form method="POST" name="finalizer">
                                            <div class="sign" hidden style="display: none">
                                                <input type="text" id="textes" hidden>
                                                <span class="sign_wrapper">
                                        <p>Signature: &angsph;</p><canvas id="can" class="myCanvas" width="400" height="80"></canvas></span>
                                            </div>

                                            <span class="split checkboxes">
                                    <input type="radio" role="checkbox" id="agreed" name="agreed" value="agree"
                                        required>
                                    <label for="agreed">I agree</label>
                                </span>

                                            <span class="split checkboxes">
                                    <input type="radio" role="checkbox" id="change" name="agreed" value="change">
                                    <label for="change">I need change</label>
                                </span>
                                            <span class="submin">
                                    <p class="terminal"><b>Note: </b>This agreement shall be governed under the jurisdiction of the state of High court in Uganda</p>
                                </span>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <%}%>
            </div>

            <div class="right_aside">
                <div class="simpo_barn">
                    <div class="uls">
                        <!-- LB Tab -->
                        <button class="art-dop_down io_aro  lis " id="related_work"> Latest Books </button>
                        <!-- LB Tab container  -->
                        <ul class="art-dop_col ul " id="pa-related_work">
                            <li class="li bord_bottom_5_lightgrey">
                                <a href="https://sadjawebsolutions.com/an-ultimate-plan-for-any-business-to-grow-online/" target="_blank" class="tex_no_deco"> An ultimate plan for any business to grow online 
                                    
                                </a>
                            </li>
                            <li class="li">
                                <a href="https://sadjawebsolutions.com/15-silly-mistakes-youre-making-business-card/" target="_blank" class="tex_no_deco">
                                    business card 15 mistakes revealed.
                                
                                </a>
                            </li>
                        </ul>
                    </div>

                    <a target="_blank" href="https://sadjawebsolutions.com/whitepapers/" class="tex_no_deco" onClick="event.preventDefault();window.open(this.href,'targetWindow',
                                   'toolbar=no',
                                    'location=no',
                                    'status=no',
                                    'menubar=no',
                                    'scrollbars=yes',
                                   ' resizable=yes',
                                   ' width=550px',
                                    'height=545px');">
                        <button class="see_more cursor_pointer">See more...</button> </a>
                </div>

                <div class="simpo_barn2">
                    <div class="uls">
                        <!-- LB Tab -->
                        <button class="art-dop_down io_aro  lis " id="related_work"> Latest News </button>
                        <!-- LB Tab container  -->
                        <ul class="art-dop_col ul " id="pa-related_work">
                            <li class="li bord_bottom_5_lightgrey">
                                <a href="https://sadjawebsolutions.com/an-ultimate-plan-for-any-business-to-grow-online/" target="_blank" class="tex_no_deco"> An ultimate plan for any business to grow online 
                                    
                                </a>
                            </li>
                            <li class="li">
                                <a href="https://sadjawebsolutions.com/15-silly-mistakes-youre-making-business-card/" target="_blank" class="tex_no_deco">
                                    business card 15 mistakes revealed.
                                
                                </a>
                            </li>
                        </ul>
                    </div>

                    <a target="_blank" href="https://sadjawebsolutions.com/whitepapers/" class="tex_no_deco" onClick="event.preventDefault();window.open(this.href,'targetWindow',
                                   'toolbar=no',
                                    'location=no',
                                    'status=no',
                                    'menubar=no',
                                    'scrollbars=yes',
                                   ' resizable=yes',
                                   ' width=550px',
                                    'height=545px');">
                        <button class="see_more cursor_pointer">See more...</button> </a>

                </div>
            </div>


        </div>
</div>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.0.943/pdf.min.js"> </script>-->


<% include ./modals/custom%>
    <!-- <script src="<%=typeof pathToTheRoot !=='undefined'?pathToTheRoot:'../'%>assets_/pdfjs-dist/build/pdf.min.js"></script>

    <script src="<%=typeof pathToTheRoot !=='undefined'?pathToTheRoot:'../'%>assets/js/initPDFViewer.js"></script>
   -->
    <script src="<%=typeof pathToTheRoot !=='undefined'?pathToTheRoot:'../'%>assets/js/custom.js"></script>
    <% include ../assets/js/reader%>
        <script src="<%=typeof pathToTheRoot !=='undefined'?pathToTheRoot:'../'%>assets/js/index.js"></script>

        <!-- <script>
            //     var myState = {
            //         pdf: null,
            //         currentPage: 1,
            //         zoom: 1
            //     }
            //     initPDFViewer(
            //         `<%=typeof pathToTheRoot !=='undefined'?pathToTheRoot:'../'%><%= typeof contract !='undefined'? contract.split("\\").join("/"):'./assets/uploads/contracts/sadja-contract.pdf'%>`,
            //         "#viewport",
            //         `<div class="post">
            //       <div class="p_body">
            //           <div class="p_body_content">
            //               <canvas></canvas>
            //           </div>
            //       </div>
            //   </div>`);

            // more code here 
            /* pdfjsLib.getDocument(`<%=typeof pathToTheRoot !=='undefined'?pathToTheRoot:'../ '%><%= typeof contract !='undefined'? contract.split("\\").join("/"):'./ assets / uploads / contracts / sadja - contract.pdf'%>`).then((pdf) => {
                myState.pdf = pdf;
                render();
                // more code here
                function render() {
                    myState.pdf.getPage(myState.currentPage).then((page) => {

                        // more code here
                        var canvas = document.getElementById("pdf_renderer");
                        var ctx = canvas.getContext('2d');

                        var viewport = page.getViewport(myState.zoom + 2);
                        page.render({
                            canvasContext: ctx,
                            viewport: viewport
                        });
                        canvas.width = viewport.width;
                        canvas.height = viewport.height;
                        // more code here


                    });
                }
            }); */
        </script> -->
        <script>
            function _preview_work(under_preview, templates) {
                let under_previews = document.querySelectorAll(under_preview);

                for (let template of templates) {
                    for (let i = 0; i < under_previews.length; i++) {
                        const preview = under_previews[i];
                        if (preview) {
                            preview.addEventListener('change', function() {
                                if (preview.checked) {
                                    let modal_ = document.querySelector(".modal_");
                                    let modal_content_ = document.querySelector(".modal_content_");
                                    // Get the template under the preview's top parent
                                    template_ = document.querySelector(template);
                                    // This fights against logging error in the console of innerHTML of null
                                    if (template_ && modal_content_) {
                                        modal_content_.innerHTML = template_.innerHTML;
                                    }

                                    // Display the modal
                                    modal_.classList.remove("hidden")
                                }
                            })
                        }
                    }
                }
            }
            _preview_work("#_preview", ["#read_tempo"]);

            // Add script for pdf conversion
            function addScript(url) {
                var script = document.createElement("script");
                script.type = "application/javascript";
                script.src = url;
                document.head.appendChild(script);
            }

            // Download pdf version of the contract
            function downloadContract(element) {
                var opt = {
                    margin: [0.5, 1],
                    filename: "Sadja-contract-" + new Date().toDateString().split(" ").join("-") + ".pdf",
                    image: {
                        type: "jpeg",
                        quality: 1
                    },
                    html2canvas: {
                        scale: 2
                    },
                    jsPDF: {
                        orientation: "p",
                        unit: "cm",
                        format: "a4",
                        putOnlyUsedFonts: true
                    },
                    pagebreak: {
                        after: ["#after1", "#after2"],
                        avoid: "b"
                    }
                };
                html2pdf()
                    .set(opt)
                    .from(element)
                    .save();
                return element
            };

            let _download = document.querySelector("#_download");
            if (_download) {
                _download.addEventListener("change", (e) => {
                    if (_download.checked) {
                        var element = document.getElementById("read_tempo");
                        downloadContract(element);
                    }
                    // We can notify about the downloading
                });
            }
            domtoimage.toSvg(document.getElementById("read_tempo"))
                .then(function(dataUrl) {
                    // var img = new Image();
                    // img.src = dataUrl;
                    // document.body.appendChild(img);
                })
                .catch(function(error) {
                    console.error('oops, something went wrong!', error);
                });

            function Edito() {
                let editos = document.querySelectorAll('.edito'),
                    editTemp = `<button type='button' class='edito-edit hidden'>Edit</button>`;
                for (let edito of editos) {
                    // edito.insertAdjacentHTML('beforeEnd', editTemp);
                    if (edito) {
                        edito.addEventListener('blur', _ => {
                            if (_.currentTarget.innerText !== '') {
                                // _.currentTarget.style.minWidth = 'unset';
                                _.currentTarget.removeAttribute('contenteditable');
                                edito.insertAdjacentHTML('beforeEnd', editTemp);
                                edit_edito(_.currentTarget);

                                _.currentTarget.addEventListener('mouseover', t => {
                                    let edito_edit = t.currentTarget.querySelector('.edito-edit');
                                    if (edito_edit) {
                                        edito_edit.classList.remove('hidden')
                                    }
                                })

                                _.currentTarget.addEventListener('mouseleave', t => {
                                    let edito_edit = t.currentTarget.querySelector('.edito-edit');
                                    if (edito_edit) {
                                        edito_edit.classList.add('hidden')
                                    }
                                })

                            }
                        });
                    }

                    function edit_edito(parent) {
                        let edit_editos = document.querySelectorAll('.edito-edit');
                        for (let edit_edito of edit_editos) {
                            if (edit_edito) {
                                edit_edito.addEventListener('click', _ => {
                                    parent = parent || _.currentTarget.parentElement;
                                    parent.setAttribute('contenteditable', 'true');
                                    parent.focus();
                                    _.currentTarget.remove();
                                })
                            }
                        }

                    }
                }
            }
            Edito();
        </script>